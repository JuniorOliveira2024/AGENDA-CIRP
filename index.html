<!DOCTYPE html>
<html lang="pt-CV">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forças Armadas de Cabo Verde - Sistema de Gerenciamento de Missões</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-dark: #0a2e5c;
            --primary: #1e4a8f;
            --primary-light: #2d6cbf;
            --secondary: #e6a50f;
            --secondary-dark: #c58a0c;
            --success: #2e7d32;
            --warning: #f57c00;
            --danger: #c62828;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --gray-light: #e9ecef;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(rgba(10, 46, 92, 0.9), rgba(10, 46, 92, 0.95)), url('https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1794&q=80') no-repeat center center/cover;
        }
        
        .login-box {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 450px;
            padding: 40px;
            text-align: center;
        }
        
        .login-logo {
            margin-bottom: 25px;
        }
        
        .login-logo h1 {
            color: var(--primary-dark);
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .logo-symbol {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 80px;
            height: 80px;
            background-color: var(--primary-dark);
            color: white;
            border-radius: 50%;
            font-size: 2rem;
            margin-bottom: 15px;
            border: 3px solid var(--secondary);
        }
        
        .login-form .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .login-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .login-form input, .login-form select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        .login-form input:focus, .login-form select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(30, 74, 143, 0.2);
        }
        
        .btn-login {
            width: 100%;
            padding: 14px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }
        
        .btn-login:hover {
            background-color: var(--primary-dark);
        }
        
        .login-footer {
            margin-top: 25px;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        /* Main Application */
        .app-container {
            display: none;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
        }
        
        .header-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header-logo .logo-symbol {
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
        }
        
        .header-logo h1 {
            font-size: 1.5rem;
            color: var(--primary-dark);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-details {
            text-align: right;
        }
        
        .user-name {
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .user-rank {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .btn-logout {
            padding: 8px 15px;
            background-color: var(--gray-light);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn-logout:hover {
            background-color: #ddd;
        }
        
        /* Navigation */
        .nav {
            background-color: var(--primary-dark);
        }
        
        .nav-list {
            display: flex;
            list-style: none;
            padding: 0 30px;
        }
        
        .nav-item {
            padding: 15px 20px;
        }
        
        .nav-link {
            color: white;
            text-decoration: none;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.3s;
        }
        
        .nav-link:hover, .nav-link.active {
            color: var(--secondary);
        }
        
        /* Main Content */
        .main-content {
            padding: 30px;
        }
        
        /* Dashboard Stats */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
        }
        
        .icon-total { background-color: var(--primary); }
        .icon-completed { background-color: var(--success); }
        .icon-progress { background-color: var(--warning); }
        .icon-pending { background-color: var(--danger); }
        
        .stat-info h3 {
            font-size: 2rem;
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .stat-info p {
            color: var(--gray);
        }
        
        /* Sections */
        .section {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.05);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .section-title {
            font-size: 1.5rem;
            color: var(--primary-dark);
        }
        
        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        /* Task List */
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-radius: 8px;
            background-color: var(--gray-light);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .task-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .task-info h4 {
            margin-bottom: 8px;
            color: var(--primary-dark);
        }
        
        .task-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .task-priority {
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .priority-low { background-color: #e8f5e9; color: #2e7d32; }
        .priority-medium { background-color: #fff3e0; color: #f57c00; }
        .priority-high { background-color: #ffebee; color: #c62828; }
        .priority-urgent { background-color: #fce4ec; color: #ad1457; }
        
        .task-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-not-started { background-color: #e0e0e0; color: #616161; }
        .status-in-progress { background-color: #e3f2fd; color: #1565c0; }
        .status-completed { background-color: #e8f5e9; color: #2e7d32; }
        
        .task-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Kanban Board */
        .kanban-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .kanban-column {
            background-color: var(--gray-light);
            border-radius: 8px;
            padding: 20px;
            min-height: 500px;
        }
        
        .kanban-column h3 {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid;
            color: var(--primary-dark);
        }
        
        .column-not-started h3 { border-color: #616161; }
        .column-in-progress h3 { border-color: #1565c0; }
        .column-completed h3 { border-color: #2e7d32; }
        
        .kanban-task {
            background-color: white;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            cursor: move;
        }
        
        .kanban-task h4 {
            margin-bottom: 8px;
            color: var(--primary-dark);
        }
        
        /* Comments Section */
        .comments-section {
            margin-top: 30px;
        }
        
        .comments-list {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding-right: 10px;
        }
        
        .comment-item {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .comment-author {
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .comment-time {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .comment-content {
            color: var(--dark);
        }
        
        .comment-form {
            display: flex;
            gap: 10px;
        }
        
        .comment-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .comment-input:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        /* Calendar */
        .calendar {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.05);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background-color: var(--primary);
            color: white;
        }
        
        .calendar-nav button {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px 15px;
        }
        
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background-color: var(--primary-light);
            color: white;
            font-weight: 600;
        }
        
        .calendar-weekday {
            padding: 15px;
            text-align: center;
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }
        
        .calendar-day {
            padding: 15px;
            border: 1px solid var(--gray-light);
            min-height: 100px;
            position: relative;
        }
        
        .day-number {
            position: absolute;
            top: 10px;
            right: 10px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .calendar-day.other-month {
            background-color: #f8f9fa;
            color: var(--gray);
        }
        
        .calendar-day.today {
            background-color: rgba(30, 74, 143, 0.1);
        }
        
        .calendar-events {
            margin-top: 25px;
            max-height: 70px;
            overflow-y: auto;
        }
        
        .calendar-event {
            font-size: 0.75rem;
            padding: 3px 6px;
            margin-bottom: 3px;
            border-radius: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .event-high { background-color: #ffebee; color: #c62828; }
        .event-medium { background-color: #fff3e0; color: #f57c00; }
        .event-low { background-color: #e8f5e9; color: #2e7d32; }
        .event-urgent { background-color: #fce4ec; color: #ad1457; }
        
        /* Forms */
        .form-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: var(--primary-dark);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* User DB Info */
        .user-db-info {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f4fd;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }
        
        .user-db-info h4 {
            color: var(--primary-dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Responsive Design */
        @media (max-width: 992px) {
            .nav-list {
                flex-direction: column;
                padding: 0;
            }
            
            .nav-item {
                padding: 12px 30px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .comment-form {
                flex-direction: column;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .user-info {
                flex-direction: column;
                gap: 10px;
            }
            
            .user-details {
                text-align: center;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .task-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .task-actions {
                align-self: flex-end;
            }
            
            .kanban-board {
                grid-template-columns: 1fr;
            }
            
            .calendar-days .calendar-day {
                min-height: 80px;
                padding: 10px 5px;
            }
            
            .calendar-event {
                font-size: 0.7rem;
                padding: 2px 4px;
            }
        }
        
        @media (max-width: 576px) {
            .login-box {
                padding: 30px 20px;
                margin: 20px;
            }
            
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <div class="login-logo">
                <div class="logo-symbol">
                    <img src="img/Brasão das FA 4-4.png"width="70" height="70" alt="Logotipo Forças Armadas">
                </div>
                <h1>Forças Armadas de Cabo Verde</h1>
                <p>Sistema de Gerenciamento de Missões</p>
            </div>
            
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="fullName">Nome Completo</label>
                    <input type="text" id="fullName" placeholder="Nome Completo" required>
                </div>
                
                <div class="form-group">
                    <label for="militaryRank">Posto/Função Militar</label>
                    <select id="militaryRank" required>
                        <option value="">Selecione o posto/função</option>
                        <option value="Soldado">Soldado</option>
                        <option value="Cabo">Cabo</option>
                        <option value="Sargento">Sargento</option>
                        <option value="Tenente">Tenente</option>
                        <option value="Tenente">Primeiro-Tenente</option>
                        <option value="Capitão">Capitão</option>
                        <option value="Major">Major</option>

                    </select>
                </div>
                
                <div class="form-group">
                    <label for="userId">ID de Utilizador (único)</label>
                    <input type="text" id="userId" placeholder="Ex: fa2025" required>
                    <small style="color: var(--gray);">Este ID será usado para o seu banco de dados pessoal</small>
                </div>
                
                <button type="submit" class="btn-login">
                    <i class="fas fa-sign-in-alt"></i> Acessar Sistema
                </button>
            </form>
            
            <div class="login-footer">
                <p>Acesso restrito ao pessoal autorizado das Forças Armadas de Cabo Verde</p>
                <p style="margin-top: 10px; font-size: 0.8rem;">Cada utilizador possui banco de dados isolado</p>
            </div>
        </div>
    </div>
    
    <!-- Main Application -->
    <div class="app-container" id="appContainer">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-logo">
                    <div class="logo-symbol">
                        <img src="img/Brasão das FA 4-4.png"width="70" height="70" alt="Logotipo Forças Armadas">
                    </div>
                    <h1>FACV - Sistema de Missões</h1>
                </div>
                
                <div class="user-info">
                    <div class="user-details">
                        <div class="user-name" id="loggedUserName">Tenente João Silva</div>
                        <div class="user-rank" id="loggedUserRank">Tenente</div>
                        <div class="user-id" id="loggedUserId" style="font-size: 0.8rem; color: var(--gray);">ID: JSilva2023</div>
                    </div>
                    <button class="btn-logout" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Navigation -->
        <nav class="nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i> Cirp
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="missions">
                        <i class="fas fa-tasks"></i> Missões Recentes
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="reports">
                        <i class="fas fa-flag"></i> Relatórios das Missões
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="calendar">
                        <i class="fas fa-calendar-alt"></i> Calendário de Missões
                    </a>
                </li>
            </ul>
        </nav>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section class="content-section active" id="dashboardSection">
                <div class="user-db-info">
                    <h4><i class="fas fa-database"></i> Mensagem de Votos</h4>
                    <p>Desejamos a todos uma excelente organização dos trabalhos, pautada pela disciplina, pelo espírito de cooperação e pelo elevado sentido de responsabilidade. Que a execução das missões atribuídas decorra com eficiência, rigor e profissionalismo, garantindo o cumprimento dos objetivos estabelecidos e o sucesso das atividades planeadas.

Que o empenho, a dedicação e a coesão de todos sejam fatores determinantes para o bom desempenho das tarefas, contribuindo para resultados positivos e para o fortalecimento da missão institucional.</p>
                    <div style="display: flex; gap: 20px; margin-top: 10px; font-size: 0.9rem;">
                        <div><strong>ID do Banco:</strong> <span id="dbIdDisplay">JSilva2023</span></div>
                        <div><strong>Utilizador:</strong> <span id="dbUserDisplay">Tenente João Silva</span></div>
                        <div><strong>Missões:</strong> <span id="dbTasksCount">0</span></div>
                    </div>
                </div>
                
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon icon-total">
                            <i class="fas fa-flag"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalTasks">0</h3>
                            <p>Total de Missões</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon icon-completed">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="completedTasks">0</h3>
                            <p>Missões Concluídas</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon icon-progress">
                            <i class="fas fa-spinner"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="inProgressTasks">0</h3>
                            <p>Missões em Andamento</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon icon-pending">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="pendingTasks">0</h3>
                            <p>Missões Pendentes</p>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Missões Recentes</h2>
                        <button class="btn btn-primary" id="addTaskBtn">
                            <i class="fas fa-plus"></i> Nova Missão
                        </button>
                    </div>
                    
                    <div class="task-list" id="recentTasksList">
                        <!-- Tasks will be loaded here dynamically -->
                    </div>
                </div>
            </section>
            
            <!-- Missions Section -->
            <section class="content-section" id="missionsSection">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Quadro de Missões</h2>
                        <div>
                            <button class="btn btn-primary" id="addTaskBtn2">
                                <i class="fas fa-plus"></i> Nova Missão
                            </button>
                            <button class="btn" onclick="exportUserData()">
                                <i class="fas fa-download"></i> Exportar Dados
                            </button>
                        </div>
                    </div>
                    
                    <div class="kanban-board" id="kanbanBoard">
                        <div class="kanban-column column-not-started">
                            <h3>Não Iniciadas</h3>
                            <div class="kanban-column-content" data-status="not-started">
                                <!-- Tasks will be loaded here dynamically -->
                            </div>
                        </div>
                        
                        <div class="kanban-column column-in-progress">
                            <h3>Em Andamento</h3>
                            <div class="kanban-column-content" data-status="in-progress">
                                <!-- Tasks will be loaded here dynamically -->
                            </div>
                        </div>
                        
                        <div class="kanban-column column-completed">
                            <h3>Concluídas</h3>
                            <div class="kanban-column-content" data-status="completed">
                                <!-- Tasks will be loaded here dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Reports Section -->
            <section class="content-section" id="reportsSection">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Relatórios das Missões</h2>
                    </div>
                    
                    <div class="comments-section">
                        <h3 style="margin-bottom: 20px; color: var(--primary-dark);">Comentários</h3>
                        
                        <div class="comments-list" id="commentsList">
                            <!-- Comments will be loaded here dynamically -->
                        </div>
                        
                        <form class="comment-form" id="commentForm">
                            <input type="text" class="comment-input" id="commentInput" placeholder="Digite seu comentário..." required>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> Enviar
                            </button>
                        </form>
                    </div>
                    
                    <div style="margin-top: 40px;">
                        <h3 style="margin-bottom: 15px; color: var(--primary-dark);">Estatísticas de Execução</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            <div style="background-color: var(--gray-light); padding: 20px; border-radius: 8px;">
                                <h4 style="margin-bottom: 10px; color: var(--primary-dark);">Progresso por Responsável</h4>
                                <div id="progressByResponsible">
                                    <!-- Progress by responsible will be loaded here -->
                                </div>
                            </div>
                            <div style="background-color: var(--gray-light); padding: 20px; border-radius: 8px;">
                                <h4 style="margin-bottom: 10px; color: var(--primary-dark);">Missões por Prioridade</h4>
                                <div id="tasksByPriority">
                                    <!-- Tasks by priority will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Calendar Section -->
            <section class="content-section" id="calendarSection">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Calendário de Agendamento de Missões</h2>
                        <button class="btn btn-primary" id="addTaskBtn3">
                            <i class="fas fa-plus"></i> Nova Missão
                        </button>
                    </div>
                    
                    <div class="calendar">
                        <div class="calendar-header">
                            <button id="prevMonth"><i class="fas fa-chevron-left"></i></button>
                            <h3 id="currentMonth">Dezembro 2026</h3>
                            <button id="nextMonth"><i class="fas fa-chevron-right"></i></button>
                        </div>
                        
                        <div class="calendar-weekdays">
                            <div class="calendar-weekday">Dom</div>
                            <div class="calendar-weekday">Seg</div>
                            <div class="calendar-weekday">Ter</div>
                            <div class="calendar-weekday">Qua</div>
                            <div class="calendar-weekday">Qui</div>
                            <div class="calendar-weekday">Sex</div>
                            <div class="calendar-weekday">Sáb</div>
                        </div>
                        
                        <div class="calendar-days" id="calendarDays">
                            <!-- Calendar days will be generated here dynamically -->
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3 style="margin-bottom: 15px; color: var(--primary-dark);">Legenda</h3>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 15px; height: 15px; background-color: #ffebee; border-radius: 3px;"></div>
                                <span>Prioridade Alta</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 15px; height: 15px; background-color: #fff3e0; border-radius: 3px;"></div>
                                <span>Prioridade Média</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 15px; height: 15px; background-color: #e8f5e9; border-radius: 3px;"></div>
                                <span>Prioridade Baixa</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 15px; height: 15px; background-color: #fce4ec; border-radius: 3px;"></div>
                                <span>Prioridade Urgente</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
    
    <!-- Task Form Modal -->
    <div class="form-modal" id="taskFormModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nova Missão/Tarefa</h2>
                <button class="close-modal" id="closeModalBtn">&times;</button>
            </div>
            
            <form id="taskForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="taskTitle">Título da Missão *</label>
                        <input type="text" id="taskTitle" placeholder="Ex: Patrulha de segurança na zona norte" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="taskPriority">Prioridade *</label>
                        <select id="taskPriority" required>
                            <option value="">Selecione a prioridade</option>
                            <option value="low">Baixa</option>
                            <option value="medium">Média</option>
                            <option value="high">Alta</option>
                            <option value="urgent">Urgente</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="taskDescription">Descrição da Missão *</label>
                    <textarea id="taskDescription" placeholder="Descreva detalhadamente a missão a ser realizada..." required></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="taskDeadline">Prazo *</label>
                        <input type="date" id="taskDeadline" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="taskResponsible">Responsável *</label>
                        <select id="taskResponsible" required>
                            <option value="">Selecione o responsável</option>
                            <option value="Capitão Lavinio Lopes">Capitão Lavinio Lopes</option>
                            <option value="Sargento Junior Oliveira">Sargento Junior Oliveira</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="taskStatus">Status *</label>
                    <select id="taskStatus" required>
                        <option value="not-started">Não Iniciada</option>
                        <option value="in-progress">Em Andamento</option>
                        <option value="completed">Concluída</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="taskProgress">Progresso (%)</label>
                    <input type="range" id="taskProgress" min="0" max="100" value="0">
                    <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                        <span>0%</span>
                        <span id="progressValue">0%</span>
                        <span>100%</span>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: flex-end; gap: 15px; margin-top: 30px;">
                    <button type="button" class="btn" id="cancelTaskBtn">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Missão</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Application State
        let currentUser = null;
        let currentUserId = null;
        let tasks = [];
        let comments = [];
        let editingTaskId = null;
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        
        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const appContainer = document.getElementById('appContainer');
        const loginForm = document.getElementById('loginForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const loggedUserName = document.getElementById('loggedUserName');
        const loggedUserRank = document.getElementById('loggedUserRank');
        const loggedUserId = document.getElementById('loggedUserId');
        const navLinks = document.querySelectorAll('.nav-link');
        const contentSections = document.querySelectorAll('.content-section');
        const addTaskBtns = document.querySelectorAll('[id^="addTaskBtn"]');
        const taskFormModal = document.getElementById('taskFormModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelTaskBtn = document.getElementById('cancelTaskBtn');
        const taskForm = document.getElementById('taskForm');
        const progressSlider = document.getElementById('taskProgress');
        const progressValue = document.getElementById('progressValue');
        const commentForm = document.getElementById('commentForm');
        const commentInput = document.getElementById('commentInput');
        const commentsList = document.getElementById('commentsList');
        const calendarDays = document.getElementById('calendarDays');
        const currentMonthElement = document.getElementById('currentMonth');
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');
        const dbIdDisplay = document.getElementById('dbIdDisplay');
        const dbUserDisplay = document.getElementById('dbUserDisplay');
        const dbTasksCount = document.getElementById('dbTasksCount');
        
        // Database Structure
        class UserDatabase {
            constructor(userId) {
                this.userId = userId;
                this.storagePrefix = `facv_user_${userId}_`;
            }
            
            // Save tasks
            saveTasks(tasksArray) {
                localStorage.setItem(this.storagePrefix + 'tasks', JSON.stringify(tasksArray));
            }
            
            // Load tasks
            loadTasks() {
                const tasksData = localStorage.getItem(this.storagePrefix + 'tasks');
                return tasksData ? JSON.parse(tasksData) : [];
            }
            
            // Save comments
            saveComments(commentsArray) {
                localStorage.setItem(this.storagePrefix + 'comments', JSON.stringify(commentsArray));
            }
            
            // Load comments
            loadComments() {
                const commentsData = localStorage.getItem(this.storagePrefix + 'comments');
                return commentsData ? JSON.parse(commentsData) : [];
            }
            
            // Save user settings
            saveUserSettings(settings) {
                localStorage.setItem(this.storagePrefix + 'settings', JSON.stringify(settings));
            }
            
            // Load user settings
            loadUserSettings() {
                const settingsData = localStorage.getItem(this.storagePrefix + 'settings');
                return settingsData ? JSON.parse(settingsData) : {};
            }
            
            // Get all user data (for export)
            getAllData() {
                return {
                    userId: this.userId,
                    tasks: this.loadTasks(),
                    comments: this.loadComments(),
                    settings: this.loadUserSettings(),
                    exportDate: new Date().toISOString()
                };
            }
            
            // Clear all user data (admin function)
            clearAllData() {
                localStorage.removeItem(this.storagePrefix + 'tasks');
                localStorage.removeItem(this.storagePrefix + 'comments');
                localStorage.removeItem(this.storagePrefix + 'settings');
            }
            
            // Check if user exists
            static userExists(userId) {
                return localStorage.getItem(`facv_user_${userId}_tasks`) !== null;
            }
            
            // Get all registered users (admin function)
            static getAllUsers() {
                const users = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('facv_user_') && key.endsWith('_tasks')) {
                        const userId = key.replace('facv_user_', '').replace('_tasks', '');
                        const userData = localStorage.getItem(`facv_user_${userId}_settings`);
                        const userInfo = userData ? JSON.parse(userData) : { userId };
                        users.push(userInfo);
                    }
                }
                return users;
            }
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            const savedUser = localStorage.getItem('facv_current_user');
            if (savedUser) {
                const userData = JSON.parse(savedUser);
                currentUser = userData;
                currentUserId = userData.userId;
                loadUserDatabase();
                showApp();
            }
            
            // Setup event listeners
            setupEventListeners();
        });
        
        // Setup event listeners
        function setupEventListeners() {
            // Login form submission
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const fullName = document.getElementById('fullName').value.trim();
                const militaryRank = document.getElementById('militaryRank').value;
                const userId = document.getElementById('userId').value.trim();
                
                if (!fullName || !militaryRank || !userId) {
                    alert('Por favor, preencha todos os campos obrigatórios.');
                    return;
                }
                
                // Check if user ID is valid (alphanumeric)
                if (!/^[a-zA-Z0-9]+$/.test(userId)) {
                    alert('O ID de utilizador deve conter apenas letras e números (sem espaços ou caracteres especiais).');
                    return;
                }
                
                // Save user info
                currentUser = {
                    fullName: fullName,
                    rank: militaryRank,
                    userId: userId,
                    loginTime: new Date().toISOString()
                };
                
                currentUserId = userId;
                
                // Initialize user database
                loadUserDatabase();
                
                // Save current user session
                localStorage.setItem('facv_current_user', JSON.stringify(currentUser));
                
                // Initialize sample data for new users
                if (!UserDatabase.userExists(userId)) {
                    initializeSampleData();
                    // Save user settings
                    const userDb = new UserDatabase(userId);
                    userDb.saveUserSettings({
                        fullName: fullName,
                        rank: militaryRank,
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString()
                    });
                }
                
                // Add comment
                addComment(`${fullName} (${militaryRank}) acessou o sistema.`, null);
                
                showApp();
            });
            
            // Logout button
            logoutBtn.addEventListener('click', function() {
                // Add comment
                addComment(`${currentUser.fullName} (${currentUser.rank}) saiu do sistema.`, null);
                
                // Save user settings with last logout time
                const userDb = new UserDatabase(currentUserId);
                const settings = userDb.loadUserSettings();
                settings.lastLogout = new Date().toISOString();
                userDb.saveUserSettings(settings);
                
                currentUser = null;
                currentUserId = null;
                localStorage.removeItem('facv_current_user');
                showLogin();
            });
            
            // Navigation links
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active nav link
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding section
                    const sectionId = this.getAttribute('data-section') + 'Section';
                    contentSections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === sectionId) {
                            section.classList.add('active');
                        }
                    });
                    
                    // Update dashboard when showing dashboard section
                    if (sectionId === 'dashboardSection') {
                        updateDashboardStats();
                        loadRecentTasks();
                    }
                    
                    // Update kanban when showing missions section
                    if (sectionId === 'missionsSection') {
                        loadKanbanBoard();
                    }
                    
                    // Update reports when showing reports section
                    if (sectionId === 'reportsSection') {
                        loadComments();
                        updateReportsStats();
                    }
                    
                    // Update calendar when showing calendar section
                    if (sectionId === 'calendarSection') {
                        generateCalendar(currentMonth, currentYear);
                    }
                });
            });
            
            // Add task buttons
            addTaskBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    editingTaskId = null;
                    resetTaskForm();
                    taskFormModal.style.display = 'flex';
                });
            });
            
            // Close modal buttons
            closeModalBtn.addEventListener('click', closeModal);
            cancelTaskBtn.addEventListener('click', closeModal);
            
            // Task form submission
            taskForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const taskData = {
                    id: editingTaskId || Date.now(),
                    title: document.getElementById('taskTitle').value.trim(),
                    description: document.getElementById('taskDescription').value.trim(),
                    priority: document.getElementById('taskPriority').value,
                    deadline: document.getElementById('taskDeadline').value,
                    responsible: document.getElementById('taskResponsible').value,
                    status: document.getElementById('taskStatus').value,
                    progress: parseInt(document.getElementById('taskProgress').value),
                    updatedAt: new Date().toISOString(),
                    createdBy: currentUser.userId
                };
                
                if (!editingTaskId) {
                    // New task
                    taskData.createdAt = new Date().toISOString();
                    tasks.push(taskData);
                    
                    // Add comment
                    addComment(`${currentUser.fullName} criou a missão "${taskData.title}".`, taskData.id);
                } else {
                    // Update existing task
                    const taskIndex = tasks.findIndex(t => t.id === editingTaskId);
                    if (taskIndex !== -1) {
                        const oldTask = tasks[taskIndex];
                        taskData.createdAt = oldTask.createdAt;
                        tasks[taskIndex] = taskData;
                        
                        // Add comment
                        addComment(`${currentUser.fullName} atualizou a missão "${taskData.title}".`, taskData.id);
                    }
                }
                
                saveTasks();
                closeModal();
                
                // Update UI
                updateDashboardStats();
                loadRecentTasks();
                loadKanbanBoard();
                generateCalendar(currentMonth, currentYear);
                updateReportsStats();
            });
            
            // Progress slider update
            progressSlider.addEventListener('input', function() {
                progressValue.textContent = this.value + '%';
            });
            
            // Comment form submission
            commentForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const content = commentInput.value.trim();
                if (!content) return;
                
                addComment(content, null);
                commentInput.value = '';
                commentInput.focus();
            });
            
            // Calendar navigation
            prevMonthBtn.addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                generateCalendar(currentMonth, currentYear);
            });
            
            nextMonthBtn.addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                generateCalendar(currentMonth, currentYear);
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target === taskFormModal) {
                    closeModal();
                }
            });
            
            // Set deadline to tomorrow by default
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('taskDeadline').valueAsDate = tomorrow;
        }
        
        // Load user database
        function loadUserDatabase() {
            if (!currentUserId) return;
            
            const userDb = new UserDatabase(currentUserId);
            
            // Load user data
            tasks = userDb.loadTasks();
            comments = userDb.loadComments();
            
            // Initialize sample data if no tasks exist
            if (tasks.length === 0) {
                initializeSampleData();
            }
            
            // Update UI
            updateDashboardStats();
            loadRecentTasks();
            loadKanbanBoard();
            loadComments();
            generateCalendar(currentMonth, currentYear);
            
            // Update database info display
            dbIdDisplay.textContent = currentUserId;
            dbUserDisplay.textContent = currentUser.fullName;
            dbTasksCount.textContent = tasks.length;
        }
        
        // Initialize sample data for new users
        function initializeSampleData() {
            // Sample tasks
            const sampleTasks = [
                {
                    id: 1,
                    title: "Banner VII Edição Corrida das Forças Armadas",
                    description: "Trabalhando no desenvolvimento do Banner da Corrida.",
                    priority: "high",
                    deadline: getDateString(5),
                    responsible: currentUser.fullName,
                    status: "in-progress",
                    progress: 65,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    createdBy: currentUserId
                },
                {
                    id: 2,
                    title: "Reunião Conselho Superior de Comando Alargada a Diretores e serviços",
                    description: "O evento, que verá decorrer nos dias 12 e 13 de março, no Auditório do Edifício do Estado-Maior das Forças Armadas,",
                    priority: "medium",
                    deadline: getDateString(3),
                    responsible: "CIRP",
                    status: "not-started",
                    progress: 0,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    createdBy: currentUserId
                },
                {
                    id: 3,
                    title: "Feira de Saúde - Plateau",
                    description: "Hoje, 7 de fevereiro, as Forças Armadas de Cabo Verde realizaram uma Feira de Saúde na Rua Pedonal do Plateau em comemoração ao 59º aniversário, com consultas médicas, cuidados de enfermagem, atuação da Banda Militar e ações de sensibilização sobre o Serviço Militar Obrigatório.",
                    priority: "medium",
                    deadline: getDateString(-2),
                    responsible: "Capitão Lavinio Lopes e Sargento Junior Oliveira",
                    status: "completed",
                    progress: 100,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    createdBy: currentUserId
                }
            ];
            
            tasks = sampleTasks;
            saveTasks();
            
            // Sample comments
            const sampleComments = [
                {
                    id: 1,
                    missionId: 1,
                    author: currentUser.fullName,
                    rank: currentUser.rank,
                    content: "Bem-vindo ao seu banco de dados pessoal do Sistema de Missões das Forças Armadas de Cabo Verde.",
                    timestamp: new Date().toISOString(),
                    createdBy: currentUserId
                },
                {
                    id: 2,
                    missionId: 1,
                    author: currentUser.fullName,
                    rank: currentUser.rank,
                    content: "Esta é uma missão de exemplo. Você pode editar ou excluir conforme necessário.",
                    timestamp: new Date(Date.now() - 3600000).toISOString(),
                    createdBy: currentUserId
                }
            ];
            
            comments = sampleComments;
            saveComments();
        }
        
        // Helper function to get date string
        function getDateString(daysFromNow) {
            const date = new Date();
            date.setDate(date.getDate() + daysFromNow);
            return date.toISOString().split('T')[0];
        }
        
        // Show application after login
        function showApp() {
            loginPage.style.display = 'none';
            appContainer.style.display = 'block';
            
            // Update user info in header
            loggedUserName.textContent = currentUser.fullName;
            loggedUserRank.textContent = currentUser.rank;
            loggedUserId.textContent = `ID: ${currentUser.userId}`;
            
            // Update database info
            dbIdDisplay.textContent = currentUser.userId;
            dbUserDisplay.textContent = currentUser.fullName;
            dbTasksCount.textContent = tasks.length;
            
            // Update dashboard
            updateDashboardStats();
            loadRecentTasks();
        }
        
        // Show login page
        function showLogin() {
            loginPage.style.display = 'flex';
            appContainer.style.display = 'none';
            
            // Reset login form
            loginForm.reset();
        }
        
        // Close modal
        function closeModal() {
            taskFormModal.style.display = 'none';
        }
        
        // Reset task form
        function resetTaskForm() {
            taskForm.reset();
            progressSlider.value = 0;
            progressValue.textContent = '0%';
            document.getElementById('taskTitle').focus();
            
            // Set deadline to tomorrow by default
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('taskDeadline').valueAsDate = tomorrow;
            
            // Update form title if editing
            document.querySelector('.modal-title').textContent = 
                editingTaskId ? 'Editar Missão' : 'Nova Missão';
        }
        
        // Save tasks to user database
        function saveTasks() {
            if (!currentUserId) return;
            const userDb = new UserDatabase(currentUserId);
            userDb.saveTasks(tasks);
            
            // Update database info
            dbTasksCount.textContent = tasks.length;
        }
        
        // Save comments to user database
        function saveComments() {
            if (!currentUserId) return;
            const userDb = new UserDatabase(currentUserId);
            userDb.saveComments(comments);
        }
        
        // Update dashboard statistics
        function updateDashboardStats() {
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.status === 'completed').length;
            const inProgressTasks = tasks.filter(t => t.status === 'in-progress').length;
            const pendingTasks = tasks.filter(t => t.status === 'not-started').length;
            
            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('inProgressTasks').textContent = inProgressTasks;
            document.getElementById('pendingTasks').textContent = pendingTasks;
        }
        
        // Load recent tasks (last 5)
        function loadRecentTasks() {
            const recentTasksList = document.getElementById('recentTasksList');
            recentTasksList.innerHTML = '';
            
            // Sort tasks by update date (newest first)
            const sortedTasks = [...tasks].sort((a, b) => 
                new Date(b.updatedAt) - new Date(a.updatedAt)
            );
            
            // Get only the 5 most recent
            const recentTasks = sortedTasks.slice(0, 5);
            
            recentTasks.forEach(task => {
                recentTasksList.appendChild(createTaskElement(task));
            });
            
            if (recentTasks.length === 0) {
                recentTasksList.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">Nenhuma missão cadastrada.</p>';
            }
        }
        
        // Create task element for list view
        function createTaskElement(task) {
            const taskElement = document.createElement('div');
            taskElement.className = 'task-item';
            taskElement.dataset.id = task.id;
            
            // Priority class
            const priorityClass = `priority-${task.priority}`;
            const priorityText = {
                'low': 'Baixa',
                'medium': 'Média', 
                'high': 'Alta',
                'urgent': 'Urgente'
            }[task.priority];
            
            // Status class
            const statusClass = `status-${task.status}`;
            const statusText = {
                'not-started': 'Não Iniciada',
                'in-progress': 'Em Andamento',
                'completed': 'Concluída'
            }[task.status];
            
            // Format date
            const deadlineDate = new Date(task.deadline);
            const formattedDate = deadlineDate.toLocaleDateString('pt-CV');
            
            taskElement.innerHTML = `
                <div class="task-info">
                    <h4>${task.title}</h4>
                    <div class="task-meta">
                        <span><i class="far fa-calendar"></i> Prazo: ${formattedDate}</span>
                        <span><i class="fas fa-user"></i> ${task.responsible}</span>
                        <span class="task-priority ${priorityClass}">${priorityText}</span>
                        <span class="task-status ${statusClass}">${statusText}</span>
                        <span><i class="fas fa-chart-line"></i> ${task.progress}% concluído</span>
                    </div>
                </div>
                <div class="task-actions">
                    <button class="btn" onclick="editTask(${task.id})">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                    <button class="btn btn-danger" onclick="deleteTask(${task.id})">
                        <i class="fas fa-trash"></i> Excluir
                    </button>
                </div>
            `;
            
            return taskElement;
        }
        
        // Load kanban board
        function loadKanbanBoard() {
            const statusColumns = {
                'not-started': document.querySelector('[data-status="not-started"]'),
                'in-progress': document.querySelector('[data-status="in-progress"]'),
                'completed': document.querySelector('[data-status="completed"]')
            };
            
            // Clear all columns
            Object.values(statusColumns).forEach(column => {
                column.innerHTML = '';
            });
            
            // Add tasks to corresponding columns
            tasks.forEach(task => {
                const kanbanTask = createKanbanTaskElement(task);
                statusColumns[task.status].appendChild(kanbanTask);
            });
            
            // Make tasks draggable
            makeTasksDraggable();
        }
        
        // Create kanban task element
        function createKanbanTaskElement(task) {
            const taskElement = document.createElement('div');
            taskElement.className = 'kanban-task';
            taskElement.dataset.id = task.id;
            taskElement.draggable = true;
            
            // Priority class
            const priorityClass = `priority-${task.priority}`;
            const priorityText = {
                'low': 'Baixa',
                'medium': 'Média', 
                'high': 'Alta',
                'urgent': 'Urgente'
            }[task.priority];
            
            // Format date
            const deadlineDate = new Date(task.deadline);
            const formattedDate = deadlineDate.toLocaleDateString('pt-CV');
            
            taskElement.innerHTML = `
                <h4>${task.title}</h4>
                <p style="font-size: 0.9rem; margin-bottom: 10px; color: var(--gray);">${task.description.substring(0, 80)}...</p>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span class="task-priority ${priorityClass}" style="font-size: 0.75rem;">${priorityText}</span>
                    <span style="font-size: 0.8rem;"><i class="far fa-calendar"></i> ${formattedDate}</span>
                </div>
                <div style="margin-top: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-size: 0.8rem;">Progresso:</span>
                        <span style="font-size: 0.8rem; font-weight: 600;">${task.progress}%</span>
                    </div>
                    <div style="height: 8px; background-color: #e0e0e0; border-radius: 4px; overflow: hidden;">
                        <div style="height: 100%; width: ${task.progress}%; background-color: var(--primary);"></div>
                    </div>
                </div>
                <div style="margin-top: 10px; display: flex; justify-content: space-between;">
                    <span style="font-size: 0.8rem;"><i class="fas fa-user"></i> ${task.responsible}</span>
                    <button class="btn" onclick="editTask(${task.id})" style="padding: 3px 8px; font-size: 0.8rem;">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
            `;
            
            return taskElement;
        }
        
        // Make tasks draggable for kanban board
        function makeTasksDraggable() {
            const kanbanTasks = document.querySelectorAll('.kanban-task');
            const kanbanColumns = document.querySelectorAll('.kanban-column-content');
            
            kanbanTasks.forEach(task => {
                task.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', this.dataset.id);
                    this.style.opacity = '0.5';
                });
                
                task.addEventListener('dragend', function() {
                    this.style.opacity = '1';
                });
            });
            
            kanbanColumns.forEach(column => {
                column.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.style.backgroundColor = 'rgba(30, 74, 143, 0.1)';
                });
                
                column.addEventListener('dragleave', function() {
                    this.style.backgroundColor = '';
                });
                
                column.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.backgroundColor = '';
                    
                    const taskId = parseInt(e.dataTransfer.getData('text/plain'));
                    const newStatus = this.dataset.status;
                    
                    updateTaskStatus(taskId, newStatus);
                });
            });
        }
        
        // Update task status (for drag and drop)
        function updateTaskStatus(taskId, newStatus) {
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            
            if (taskIndex !== -1) {
                tasks[taskIndex].status = newStatus;
                
                // Update progress based on status
                if (newStatus === 'completed') {
                    tasks[taskIndex].progress = 100;
                } else if (newStatus === 'in-progress' && tasks[taskIndex].progress === 0) {
                    tasks[taskIndex].progress = 10;
                }
                
                tasks[taskIndex].updatedAt = new Date().toISOString();
                
                saveTasks();
                loadKanbanBoard();
                updateDashboardStats();
                loadRecentTasks();
                generateCalendar(currentMonth, currentYear);
                
                // Add comment
                const task = tasks[taskIndex];
                addComment(`${currentUser.fullName} alterou o status da missão "${task.title}" para ${newStatus === 'not-started' ? 'Não Iniciada' : newStatus === 'in-progress' ? 'Em Andamento' : 'Concluída'}.`, task.id);
            }
        }
        
        // Load comments
        function loadComments() {
            commentsList.innerHTML = '';
            
            // Sort by timestamp (newest first)
            const sortedComments = [...comments].sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
            );
            
            sortedComments.forEach(comment => {
                commentsList.appendChild(createCommentElement(comment));
            });
            
            if (comments.length === 0) {
                commentsList.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">Nenhum comentário ainda.</p>';
            }
            
            // Scroll to bottom
            commentsList.scrollTop = commentsList.scrollHeight;
        }
        
        // Create comment element
        function createCommentElement(comment) {
            const commentElement = document.createElement('div');
            commentElement.className = 'comment-item';
            
            const date = new Date(comment.timestamp);
            const formattedDate = date.toLocaleDateString('pt-CV') + ' ' + date.toLocaleTimeString('pt-CV', { hour: '2-digit', minute: '2-digit' });
            
            commentElement.innerHTML = `
                <div class="comment-header">
                    <div class="comment-author">${comment.author} (${comment.rank})</div>
                    <div class="comment-time">${formattedDate}</div>
                </div>
                <div class="comment-content">${comment.content}</div>
            `;
            
            return commentElement;
        }
        
        // Add comment
        function addComment(content, missionId) {
            const comment = {
                id: Date.now(),
                missionId: missionId,
                author: currentUser.fullName,
                rank: currentUser.rank,
                content: content,
                timestamp: new Date().toISOString(),
                createdBy: currentUserId
            };
            
            comments.unshift(comment);
            saveComments();
            loadComments();
            
            // Update reports stats if on reports page
            if (document.getElementById('reportsSection').classList.contains('active')) {
                updateReportsStats();
            }
        }
        
        // Update reports statistics
        function updateReportsStats() {
            // Progress by responsible
            const progressByResponsible = document.getElementById('progressByResponsible');
            const responsibles = [...new Set(tasks.map(t => t.responsible))];
            
            let progressHTML = '';
            responsibles.forEach(responsible => {
                const responsibleTasks = tasks.filter(t => t.responsible === responsible);
                const totalProgress = responsibleTasks.reduce((sum, task) => sum + task.progress, 0);
                const avgProgress = responsibleTasks.length > 0 ? Math.round(totalProgress / responsibleTasks.length) : 0;
                
                progressHTML += `
                    <div style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>${responsible}</span>
                            <span>${avgProgress}%</span>
                        </div>
                        <div style="height: 8px; background-color: #e0e0e0; border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; width: ${avgProgress}%; background-color: var(--primary);"></div>
                        </div>
                    </div>
                `;
            });
            
            progressByResponsible.innerHTML = progressHTML || '<p>Nenhum responsável encontrado.</p>';
            
            // Tasks by priority
            const tasksByPriority = document.getElementById('tasksByPriority');
            const priorityCounts = {
                low: tasks.filter(t => t.priority === 'low').length,
                medium: tasks.filter(t => t.priority === 'medium').length,
                high: tasks.filter(t => t.priority === 'high').length,
                urgent: tasks.filter(t => t.priority === 'urgent').length
            };
            
            let priorityHTML = '';
            for (const [priority, count] of Object.entries(priorityCounts)) {
                const priorityText = {
                    'low': 'Baixa',
                    'medium': 'Média', 
                    'high': 'Alta',
                    'urgent': 'Urgente'
                }[priority];
                
                priorityHTML += `
                    <div style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>${priorityText}</span>
                            <span>${count} missões</span>
                        </div>
                    </div>
                `;
            }
            
            tasksByPriority.innerHTML = priorityHTML || '<p>Nenhuma missão encontrada.</p>';
        }
        
        // Generate calendar
        function generateCalendar(month, year) {
            // Update current month display
            const monthNames = [
                "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
                "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
            ];
            
            currentMonthElement.textContent = `${monthNames[month]} ${year}`;
            
            // Get first day of month and total days
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const totalDays = lastDay.getDate();
            const firstDayIndex = firstDay.getDay();
            
            // Get today's date for highlighting
            const today = new Date();
            const todayDate = today.getDate();
            const todayMonth = today.getMonth();
            const todayYear = today.getFullYear();
            
            // Clear calendar
            calendarDays.innerHTML = '';
            
            // Previous month days
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = firstDayIndex; i > 0; i--) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day other-month';
                dayElement.innerHTML = `
                    <div class="day-number">${prevMonthLastDay - i + 1}</div>
                `;
                calendarDays.appendChild(dayElement);
            }
            
            // Current month days
            for (let day = 1; day <= totalDays; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                // Check if this is today
                if (day === todayDate && month === todayMonth && year === todayYear) {
                    dayElement.classList.add('today');
                }
                
                dayElement.innerHTML = `
                    <div class="day-number">${day}</div>
                    <div class="calendar-events" id="events-${year}-${month + 1}-${day}">
                        <!-- Events will be added here -->
                    </div>
                `;
                
                calendarDays.appendChild(dayElement);
                
                // Add tasks for this day
                const dateStr = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                addTasksToCalendar(dateStr, dayElement);
            }
            
            // Next month days
            const totalCells = 42; // 6 weeks * 7 days
            const nextMonthDays = totalCells - (firstDayIndex + totalDays);
            for (let day = 1; day <= nextMonthDays; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day other-month';
                dayElement.innerHTML = `
                    <div class="day-number">${day}</div>
                `;
                calendarDays.appendChild(dayElement);
            }
        }
        
        // Add tasks to calendar day
        function addTasksToCalendar(dateStr, dayElement) {
            const tasksForDate = tasks.filter(task => task.deadline === dateStr);
            
            if (tasksForDate.length > 0) {
                const eventsContainer = dayElement.querySelector('.calendar-events');
                
                tasksForDate.forEach(task => {
                    const eventElement = document.createElement('div');
                    eventElement.className = `calendar-event event-${task.priority}`;
                    eventElement.title = `${task.title} - ${task.responsible}`;
                    eventElement.textContent = task.title.substring(0, 15) + (task.title.length > 15 ? '...' : '');
                    eventsContainer.appendChild(eventElement);
                });
            }
        }
        
        // Edit task
        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            
            if (task) {
                editingTaskId = taskId;
                
                // Fill form with task data
                document.getElementById('taskTitle').value = task.title;
                document.getElementById('taskDescription').value = task.description;
                document.getElementById('taskPriority').value = task.priority;
                document.getElementById('taskDeadline').value = task.deadline;
                document.getElementById('taskResponsible').value = task.responsible;
                document.getElementById('taskStatus').value = task.status;
                document.getElementById('taskProgress').value = task.progress;
                progressValue.textContent = task.progress + '%';
                
                // Show modal
                taskFormModal.style.display = 'flex';
            }
        }
        
        // Delete task
        function deleteTask(taskId) {
            if (confirm('Tem certeza que deseja excluir esta missão?')) {
                const taskIndex = tasks.findIndex(t => t.id === taskId);
                
                if (taskIndex !== -1) {
                    const taskTitle = tasks[taskIndex].title;
                    tasks.splice(taskIndex, 1);
                    
                    saveTasks();
                    
                    // Update UI
                    updateDashboardStats();
                    loadRecentTasks();
                    loadKanbanBoard();
                    generateCalendar(currentMonth, currentYear);
                    updateReportsStats();
                    
                    // Add comment
                    addComment(`${currentUser.fullName} excluiu a missão "${taskTitle}".`, null);
                }
            }
        }
        
        // Export user data
        function exportUserData() {
            if (!currentUserId) return;
            
            const userDb = new UserDatabase(currentUserId);
            const userData = userDb.getAllData();
            
            // Create a downloadable JSON file
            const dataStr = JSON.stringify(userData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `facv_dados_${currentUserId}_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            // Add comment
            addComment(`${currentUser.fullName} exportou os dados do banco de dados.`, null);
            
            alert(`Dados exportados com sucesso para o arquivo: ${exportFileDefaultName}`);
        }
        
        // Function to get all users (admin only - for demonstration)
        function getAllUsers() {
            return UserDatabase.getAllUsers();
        }
        
        // Function to switch to another user (for testing)
        function switchUser(newUserId) {
            if (confirm(`Deseja realmente trocar para o usuário ${newUserId}? Todos os dados não salvos serão perdidos.`)) {
                // Save current session
                if (currentUser) {
                    const userDb = new UserDatabase(currentUserId);
                    const settings = userDb.loadUserSettings();
                    settings.lastLogout = new Date().toISOString();
                    userDb.saveUserSettings(settings);
                }
                
                // Clear current session
                currentUser = null;
                currentUserId = newUserId;
                tasks = [];
                comments = [];
                
                // Load new user
                const userDb = new UserDatabase(newUserId);
                const settings = userDb.loadUserSettings();
                
                currentUser = {
                    fullName: settings.fullName || 'Utilizador',
                    rank: settings.rank || 'N/A',
                    userId: newUserId
                };
                
                localStorage.setItem('facv_current_user', JSON.stringify(currentUser));
                loadUserDatabase();
                showApp();
            }
        }
    </script>
</body>
</html>